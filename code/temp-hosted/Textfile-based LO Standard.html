<!DOCTYPE html>
<meta charset="utf-8">
<title>Textfile-based Load Order Standard</title>
<style>
	body {font-family:Helvetica,sans-serif;font-size:10pt;}
	h1 + p {text-align:center;}
	li {margin-bottom:10px;}
	li ul, li ol {margin-top:0.4em;}
	q {font-style:italic;}
	code {display:inline-block; padding:2px 5px; background:#eee;}
	td, th {border:1px solid #ddd; padding: 5px; vertical-align:top;}
	table {border-collapse:collapse; margin:1em;background:#FafaFf;}
	thead {font-weight:bold;background:#99CCFF;}
	code.box {line-height:20px; white-space:pre; margin:1em 0 0 3em; display:table; padding:5px 10px;}
	ol li ol {list-style:lower-alpha;}
	ol li ol li ol {list-style:lower-roman;}
 ol ol li {margin-bottom:0.2em;}
	blockquote {background:#E6E6FA; display:table; padding:5px 30px 5px 10px;}
	h1 {text-align:center;font-size:24pt;}
	h2 {margin-top:3em;font-size:20pt;}
	h3 {margin-top:2em;font-size:16pt;}
	h4 {margin-top:2em;font-size:12pt;}
	a:link {text-decoration:none;}
	a:hover {text-decoration:underline;}
	a[href^="http"]:after {padding-left:2px; content: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAVklEQVR4Xn3PgQkAMQhDUXfqTu7kTtkpd5RA8AInfArtQ2iRXFWT2QedAfttj2FsPIOE1eCOlEuoWWjgzYaB/IkeGOrxXhqB+uA9Bfcm0lAZuh+YIeAD+cAqSz4kCMUAAAAASUVORK5CYII=);}
	
	ul.errorMessages > li {margin-bottom:1.4em;}
	td.t {background:#90ff90;text-align:center;}
	td.c {background:#ff9090;text-align:center;}
	td.t:after {content: '\2713';}
	td.c:after {content: '\2717';}
	img {border:0;}
	.slideshow img {opacity:0; 
		position:absolute;
		transition: opacity 1.5s;
		-moz-transition: opacity 1.5s;
		-webkit-transition: opacity 1.5s;
		-o-transition: opacity 1.5s;}
	.slideshow img:first-child {opacity:1;}
	figcaption {font-style:italic; margin-bottom:2em;}
	tr.inactive {color:#888;}
 tr.inactive td.c, tr.inactive td.t {background:#E3E3E3;}
	code.box {margin-left:0em;}
	span[title] {border-bottom: 1px dotted; font-family: sans-serif; cursor:help;}
	dt {margin-bottom:0.5em; margin-top:1em; font-style:italic;}
	dd {margin-bottom:0.8em;}
	abbr {cursor:help;}
	
	ul {margin-bottom:2em;}
</style>

<h1>The Textfile-Based Load Order Standard</h1>
<h2>Contents</h2>
<ol>
	<li><a href="#lo">An Introduction To Load Orders</a>
	<li><a href="#active">An Introduction To Active Plugins</a>
	<li><a href="#textfile">The Textfile-based Load Order Standard</a>
	<li><a href="#false">False-Flagged Plugins</a>
</ol>


<h2 id="lo">An Introduction To Load Orders</h2>
<p>This section provides a general overview of load ordering in TES III: Morrowind, TES IV: Oblivion, TES V: Skyrim, Fallout 3 and Fallout: New Vegas for those who are unfamiliar with the concept. For simplicity, <q>the game</q> will be used when the text refers to any of the games in the previous list.
<p>Mod plugins for the game are files that end in <code>.esp</code> or <code>.esm</code>. These files are created by the game's official editing tools, or by third party modders' tools. They contain various data entries, which can either be brand new additions or changes to the entries added by another plugin, including the game's main master file (Morrowind.esm, Oblivion.esm, Skyrim.esm, Fallout3.esm or FalloutNV.esm depending on the game). These entries cover almost all aspects of what is in the game, eg. NPCs, items, races, interiors, worlds, quests, etc.
<p>When the game is run, it loads each of the plugins you have installed one by one. The order in which it loads them is, unsurprisingly, what is referred to as the load order. The load order is important for two reasons:
<ul>
	<li>Dependency resolution.
	<li>Conflict resolution.
</ul>
<p>A plugin which changes the entries added by other plugins is dependent on those other plugins, and the game requires all of the latter plugins to be loaded before the former. If they aren't, the game will crash on launch.
<p>The game can only apply one version of any one entry (this is known as the <q>rule of one</q>). Therefore, when more than one plugin changes the same entry, the load order is used to decide which plugin's changes are applied. Put simply, the last loaded plugin's changes are applied. The one exception to the <q>rule of one</q> is that the contents of cells (the physical space in which your character moves) can be changed by any number of plugins, so different plugins can add objects to cells, move them around or remove them and all will see their changes applied by the game.
<p>By changing the load order, you can change which plugins override and which are overridden, and so reduce detrimental conflicts. You cannot actually reduce how much is overridden through load order alone, but it is often the case that some overrides are acceptable while others cause problems in game. Setting a good load order is the process by which you seek to maximise the former instead of the latter.
<p>Further compatibility between mods is then possible through the use of patches, which are made to address incompatibilities between specific mods, and through the use of Wrye Bash, which can create a <q>Bashed Patch</q> that allows you to select between types of changes for different mods. For example, two mods change a piece of armour, but one changes how it looks and the other changes its effectiveness: through load order alone you could only ever get one change, but using Wrye Bash you can get both, because they change different things in the same armour entry.
<p>A plugin's position in the load order is often displayed by mod managers as a hexadecimal number, from 00 to FE (0 to 255 in decimal). The plugin with position 00 loads first, and the plugin with position FE is loaded last. Hexadecimal numbers are used to display the load order positions of plugins because these numbers form the first two digits of the code that the game uses to reference the entries that the plugin adds, so knowing the numbers allows modders and mod users to determine which plugin an entry is from.

<p>So how does the game decide on the load order to use? Well, there are currently two different methods used, depending on the game (and version of the game):
<ul>
	<li>In Morrowind, Oblivion, Fallout 3, Fallout: New Vegas and early versions (pre-1.4.26) of Skyrim, load order is decided by the relative timestamps of plugins in the game's Data directory. An installed plugin's load order is therefore an intrinsic property of that plugin. The active plugin with the earliest date loads first, with plugins being listed in descending date order (earliest to latest).
	<li>In Skyrim v1.4.26+, a new textfile-based load order system was introduced, in which load order is decide by the order in which plugins are listed in <code>plugins.txt</code>. This brought with it a fundamental change, in that load order position is no longer an intrinsic property of a plugin.
</ul>
<p>There are a few hardcoded rules that trump load order, irrespective of the method used to determine it:
<ul>
 <li>Master plugins always load before non-master plugins. This is discussed in greater detail in <a href="false">False-Flagged Plugins</a>.
 <li>In Skyrim, <code>Skyrim.esm</code> always loads before all other plugins.
 <li>In Skyrim, if <code>Update.esm</code> is present, it is always loaded. If it has no load order position set, it loads after all other master plugins. That might sound a bit odd, but recall that in Skyrim v1.4.26+ load order position is not an intrinsic property of a plugin.
</ul>


<h2 id="active">An Introduction To Active Plugins</h2>
<p>We've covered what load order is, how it is used, and how the game determines it, but we haven't covered how the game knows which plugins to load, ie. which plugins are active. Once again, there are two systems used for deciding which plugins are active, depending on the game.
<ul>
	<li>Morrowind lists the filenames of the plugins that are currently active in its <code>Morrowind.ini</code> file, found in the game's install folder.
	<li>Oblivion, Skyrim, Fallout 3 and Fallout: New Vegas list the plugins that are currently active in their <code>plugins.txt</code>, by default found in the game's <code>%LOCALAPPDATA%</code> folder, but it can be relocated to the game's install folder by toggling an option in that game's ini file.
</ul>
<p>Both active plugins files are encoded in Windows-1252. This is fairly important, as it means that some plugins have filenames which cannot be represented in Windows-1252, and so cannot be activated without first renaming them.
<p>Up to 255 plugins can be active at any one time. Listing more than 255 plugins in the active plugins file will result in weirdness and broken things, as will listing a plugin more than once.
<p>An immediate consequence of Skyrim v1.4.26+ using <code>plugins.txt</code> to store both load order and active plugin information is that inactive plugins cannot be said to have any load order position. This might not seem a problem at first, since the game only cares about the relative order of the plugins it loads, but modders have engineered methods by which inactive plugins can have their changes loaded by another active plugin (eg. Wrye Bash's Bashed Patch). When any such method is used, the load order of the inactive plugins is required to resolve any dependencies and conflicts they have, both with each other and with any active plugins. As such, it becomes necessary to re-implement a system that assigns a load order position to all installed plugins, hence the textfile-based load order standard.



<h3 id="lo-textfile">The Textfile-based Load Order Standard</h3>
<p>The textfile-based load order standard was developed by Lojack (Wrye Bash), WrinklyNinja (BOSS), Kaburke (Nexus Mod Manager) and Dark0ne (owner of the Nexus sites) to serve the community's need for the ability to assign load order positions to all installed plugins in Skyrim v1.4.26+.
<p>The standard dictates that:
<ul>
	<li>An installed plugin is defined to be a plugin that is located at the location which Skyrim scans to detect plugins.
	<li>Total load order is defined as a load order which assigns a position to every installed plugin at the time at which the load order is recorded.
	<li>A blank line is defined as a string that contains only a CRLF line break.
	<li>A comment line is defined as a string that begins with a hash character (<code>#</code>) and ends with a CRLF line break.
	<li>A plugin line is defined as a string that begins with a plugin filename (basename.extension, where the extension is <code>esp</code> or <code>esm</code>), which is followed immediately by a CRLF line break.
	<li>Total load order is stored in a <code>loadorder.txt</code> file.
	<li><code>loadorder.txt</code> is encoded in UTF-8, <strong>without</strong> a Byte Order Mark.
	<li><code>loadorder.txt</code> is stored alongside the <code>plugins.txt</code>, in whichever location that is.
	<li><code>loadorder.txt</code> contains only blank lines, comment lines and plugin lines.
	<li><code>loadorder.txt</code> lists <code>Skyrim.esm</code> first.
	<li><code>loadorder.txt</code> lists all master files before all plugin files.
	<li><code>loadorder.txt</code> contains no duplicate plugin lines.
	<li><code>plugins.txt</code> is encoded in Windows-1252.
	<li><code>plugins.txt</code> contains only blank lines, comment lines and plugin lines.
	<li><code>plugins.txt</code> contains no more than 255 plugins.
	<li><code>plugins.txt</code> contains no duplicate plugin lines.
	<li>The order of the plugins listed in <code>plugins.txt</code> is identical to their order in <code>loadorder.txt</code>.
</ul>

<p>There are some situations identified that might arise for which there is no required behaviour defined. Nevertheless, the standard makes some recommendations for the handling of these situations, detailed in the table below.
<table>
	<thead><tr><th>Situation<th>Recommended Behaviour
	<tbody>
		<tr><td>An attempt is made to activate a plugin with a filename that cannot be represented in the Windows-1252 encoding.<td>Utilities check that plugin filenames can be represented correctly in Windows-1252 before attempting to activate them. Plugins with filenames that cannot be represented correctly should be skipped, and the user/client made aware of the issue.
		<tr><td>Since <code>loadorder.txt</code> was last written, plugins have been installed or uninstalled.<td>Plugins that have been uninstalled should have their lines in loadorder.txt removed, and plugins that have been installed should have lines appended to loadorder.txt.
		<tr><td>Since <code>plugins.txt</code> was last written, active plugins have been uninstalled.<td>Active plugins that have been uninstalled should have their lines in <code>plugins.txt</code> removed.
		<tr><td>The order of the plugins listed in <q>plugins.txt</q> is not identical to their order in <q>loadorder.txt</q>.<td>Utilities check for synchronisation on startup and maintain it throughout their operation, rather than re-synchronising the files on program close, for instance. This is to prevent issues for any other programs open at the same time. If desynchronisation is detected, the only standard-based recovery option is to derive <q>plugins.txt</q> from <q>loadorder.txt</q>, first getting a list of filenames to be written from <q>plugins.txt</q>. Alternatively, a utility could use some internal load order backup to restore from. See the coloured box below for a more detailed breakdown of the issue.
</table>
<blockquote><i>The Desynchronisation Problem</i>
<p>If either <code>plugins.txt</code> or <code>loadorder.txt</code> are changed such that the load order of the plugins in <code>plugins.txt</code> is not the same in <code>plugins.txt</code> and <code>loadorder.txt</code>, then the difference cannot generally be precisely resolved without discarding one file's ordering. This is due to the load order of plugins in plugins.txt being weakly defined, ie. it is defined relative to other active plugins, but not in relation to inactive plugins. An example:
<blockquote>
If you use a standard-compliant tool to set a load order of A,b,c,d,E,f,g where uppercase letters denote active plugins, then you use the Skyrim launcher to move A after E, then <code>plugins.txt</code> will read E,A while <code>loadorder.txt</code> remains unchanged. There is no way of knowing from the contents of plugins.txt whether you moved A after E or E before A. If these were the only two plugins, then it would not be an issue, but you also have inactive plugins interspersed amongst them, so you have the following possibilities, all of which are potentially valid, but also potentially damaging in terms of conflicts, etc.:
<blockquote>
b,c,d,E,A,f,g<br />
b,c,d,E,f,A,g<br />
b,c,d,E,f,g,A<br />
E,A,b,c,d,f,g
</blockquote>
There is no way of knowing which is the correct order to choose for the full load order based on the active load order. You must therefore choose to use one of the two files' orderings. Since <code>plugins.txt</code> does not define the load order positions of inactive plugins, it is unsuitable, and <code>loadorder.txt</code> must be used. The alternative would be for a utility to restore load order from their own internal backup, hence why the standard does not define a specific behaviour, as it may be <code>loadorder.txt</code> that was altered and is now wrong.
</blockquote>
</blockquote>



<h3 id="false">False-Flagged Plugins</h3>
<p>Whether a mod plugin is a master file or a non-master file is dependent not on its file extension (<code>.esp</code>, <code>.esm</code>), but is instead decided by the value of a setting inside the plugin file, known as its <q>master bit flag</q>. Master files have this set to <code>1</code>, and non-master files have it set to <code>0</code>. However, because ESM is an acronym for <q>Elder Scrolls Master</q>, and ESP is an acronym for <q>Elder Scrolls Plugin</q> (even for Fallout 3 and Fallout: New Vegas), most people assume that master plugins are files with <code>.esm</code> extensions, while non-master plugins are files with <code>.esp</code> extensions.
<p>This assumption is valid for the most part, as the vast majority of masters are <code>.esm</code> files, and the vast majority of plugins are <code>.esp</code> files. However, sometimes this is not the case. When a plugin has a <code>.esm</code> extension but has a master bit flag value of <code>0</code>, or has an extension of <code>.esp</code> and a master bit flag value of <code>1</code>, the plugin is said to be <q>false-flagged</q>, as its extension does not match its master bit flag value. False-flagged plugins are most common in Fallout 3 due to the use of FO3Edit's <q>Master Update</q> feature, which turns non-master plugins into false-flagged plugins, to avoid bugs that only manifest for non-master plugins.
<p>The distinction between masters and non-masters is important for load order because the game will always load all masters before all non-masters, regardless of whether they are listed or dated (depending on your game) as such by the mechanism used to determine load order. Earlier versions of most if not all modding utilities, put all <code>.esm</code> files before all <code>.esp</code> files, but failed to take into account the value of the master bit flag of plugins. As such, the load order they displayed was incorrect, as it failed to take into account the game always loading masters before plugins. More recent versions of the most popular modding utilities, at least, properly display all master files before all plugin files.